// Copyright 2024 Audiotool Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package audiotool.auth.v1;

import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/timestamp.proto";

// Whoami is a message that is used to determine the name of the user that
// is currently authenticated.
message Whoami {
  // The user_name of the user that is currently authenticated.
  string user_name = 1;

  // The repeated list of roles that the user has.
  repeated string roles = 2;

  // Whether the user has verified his email address.
  //
  // This will be set to true if the user has verified his email address. If the user has not 
  // verified his email address, this will be set to false.
  // 
  // Coming from an OIDC provider (e.g. Google) this will be set to true.
  bool is_email_verified = 3;
}

// PersonalAccessToken Personal access tokens are an alternative to using passwords for authentication for the Prisma API.
message PersonalAccessToken {
  option (google.api.resource) = {
    type: "token.api.audiotool.com/Token"
    pattern: "users/{username}/tokens/{uuid}"
    singular: "token"
    plural: "tokens"
  };

  // The name of the token.
  string name = 1 [(google.api.field_behavior) = IDENTIFIER];

  // The display name of the token.
  string display_name = 2;

  // The username who owns the token.
  string user_name = 3 [(google.api.field_behavior) = OUTPUT_ONLY];

  // The access token.
  //
  // The token will only be exposed once after creation. At requestion the second time the last 3 letters of the token will be exposed and prefixed with asterisks.
  string access_token = 4 [(google.api.field_behavior) = OUTPUT_ONLY];

  // The time the token was created at.
  google.protobuf.Timestamp create_time = 5 [(google.api.field_behavior) = OUTPUT_ONLY];

  // The time the token expires at. The maximum time a token can be created for is one year.
  google.protobuf.Timestamp expire_time = 6;

  // The time the token was last used.
  google.protobuf.Timestamp last_use_time = 7 [(google.api.field_behavior) = OUTPUT_ONLY];
}
